<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>FPGA Power</title>
</head>

<body>
<h2 align="center">Power Estimation/Measurement<br />
  in Quartus Prime
  <br />
Cornell ece5760</h2>
<p>&nbsp;</p>
<h3>Power Estimation</h3>
<p>Power analysis in Quartus Prime is described in <a href="../Power_Estimation/qts-qps-5v3.pdf">Quartus Prime Handbook Vol 3</a>, chapter 9. We will be concerned with the Quartus PowerPlay Power Analyzer, but not the <a href="../Power_Estimation/ug_epe.pdf">Early Power Estimator</a>. A separate application note discusses <a href="../Power_Estimation/an734_optimization.pdf">Cyclone V SoC Power Optimization</a>. </p>
<p>The dependability of the power analysis depends on the amount of detail that you give the analyser. At the very least, you need to compile, place and fit the design for the specific FPGA model and you need to estimate the time-density of signal transitions. The following example uses the project ZIP <em>GPU with <strong>FAST</strong> display from <strong>SRAM</strong></em> from the bus-master page.<br />
Steps:</p>
<ol>
  <li>In the Assignments menu, choose settings...<a href="../Power_Estimation/default_settings.PNG">PowerPlay</a></li>
  <li>In the Processing menu choose <a href="../Power_Estimation/PP_analysis_tool.PNG">PowerPlay tool</a> and set the time-density of signal transitions.<br />
    For a quick estimate set <em>Use vectorless estimation</em>.  The defaults for the analysis are shown.<br />
If you are using HPS, then open the HPS tab, enable the HPS, and <a href="../Power_Estimation/PP_HPS_settings.PNG">set the clock frequency</a>. <br />
It appears that 800 MHz is the highest you can set, which seems to match with the Qsys ARM9 dialog box.
<br />
Open the Cooling tab and (for DE1-SoC) <a href="../Power_Estimation/PP_cooling_settings.PNG">choose to no heat sink, low air flow</a>. </li>
  <li>Back in  the main PowerPlay window, press Start, wait for the analysis to finish, and press <a href="../Power_Estimation/PP_report.PNG">Report</a>. <br />
  This report is generated by the defaults above.</li>
  <li>With the HPS disabled in the HPS dialog, and explicit FPGA toggle frequencies chosen, <br />
  the <a href="../Power_Estimation/PP_no_HPS.PNG">PowerPlay tool</a> generates <a href="../Power_Estimation/PP_no_HPS_report.PNG">this report</a>.</li>
</ol>
<p>For a more accurate power estimate, you need to supply a Modelsim simulation result. <em>Section 2.2.7 Generating Power Analysis Files</em> in  <a href="../Power_Estimation/qts-qps-5v3.pdf">Quartus Prime Handbook Vol 3</a> shows how to generate a <em>value_change_dump file</em> (<span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">vcd</span> file) to feed into the power analysis tool. Further information is in section <em>9.5.2 Using .vcd for Power Estimation</em>, and particularly section <em>9.5.2.1.1 Generating a .vcd from ModelSim Software</em>.<br />
Generating an example <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">vcd</span> file in Modelsim:</p>
<ol>
  <li>Compile using <code>Compile...Compile All.</code> You should see message <code># Compile of testbench.v was successful.</code><br />
  (assumes that you are using the example from the <a href="../../ModelSim/index.html">Using Modelsim</a> page)</li>
  <li>Chose <code>Simulate...Start Simulation</code> and in the dialog box navigate to <code>work...testbench.v</code></li>
  <li>At the <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">Modelsim&gt;</span> command line choose the signals that should be in the <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">vcd</span> file.<br />
    To add all the signals from the DDS unit:
    <br />
  <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">vcd add testbench/DUT/* </span></li>
  <li>Choose <code>Simulate...Run...Run 100</code>. </li>
  <li>At the <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">Modelsim&gt;</span> command line, type <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">quit -sim</span> (or use the <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">End Simulation</span> menu item) to close the <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace">vcd</span> file.</li>
  <li>The resulting data is written into the file <span style="font-family: Consolas, 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', Monaco, 'Courier New', monospace"><a href="../Power_Estimation/dump.vcd">dump.vcd</a></span>, in the project directory.</li>
</ol>
<p>A small <a href="../Power_Estimation/example_counter_snippet.txt">example</a> (no HPS, no Qsys) was compiled in Quartus, and also simulated in <a href="../Power_Estimation/testbench_count.v">Modelsim</a> to produce a <a href="../Power_Estimation/vcd_test.vcd">vcd file</a>. 
Using just the default settings for the PowerPlay software (no vcd file, use vectorless estimate) <a href="../Power_Estimation/PP_counter_no_vcd.PNG">yields a dynamic core power of 0.29 milliwatts, with 44 mW i/o</a>. Using the vcd file, and realistic transition rates (<a href="../Power_Estimation/PP_GUI_vcd.PNG">GUI</a>) gives a <a href="../Power_Estimation/PP_counter_vcd_out_freq.PNG">power of 0.54 milliwatts, with 757 mW i/o</a>.</p>
<p><strong>Power Measurement</strong></p>
<p>The DE1-SoC board does not ship with current measurement capability. The <a href="../Power_Estimation/DE1_SoC_schematic.pdf">schematic</a> and <a href="../DE1-SoC_User_manualv.1.2.2_revE.pdf">users manual</a> suggests several ways of measuring power:</p>
<ul>
	<li>The whole board could be monitored by plugging the power adaptor into a current sensor. The current sensor output would then be applied to the onboard ADC and read by the FPGA. An example might be the <a href="../../../../../../https@www.adafruit.com/product/1164">Adafruit 1164</a>, using the TI INA169 current sensor. The sensor board has a bandwidth of 100 KHz, gain of of one volt out per amp input, and with an output noise of about 7x10<sup>-5</sup> volts. Because the current is measured for the whole board, separating out the FPGA contribution will require careful calibration, but see below.</li>
  <li></li>
  <li>From the <a href="../../../../../../https@alteraforum.com/forum/showthread.php@t=48618">Altera Forum</a>. flz47655 writes:<br />
    I measured power consumption from 12v AC/DC adapter, here are the results:<br />
fpga configured from EPCS with default demo 0.3A<br />
fpga configured from EPCS with default demo + sd inserted 0.42A<br />
fpga configured from HPS with no SD 0.25A<br />
fpga configured from HPS with SD with Linux Console 0.37A<br />
fpga configured from HPS with SD with Linux Console with ethernet cable connected 0.51A<br />
fpga configured from HPS with SD with Linux Console with ethernet cable connected + cpu1 100% 0.52A<br />
fpga configured from HPS with SD with Linux Console with ethernet cable connected + cpu1 100% + cpu2 100% 0.53A<br />
With fpga only are 12*0.3=3.6W, a lot of power. Someone can confirm this   is normal and my board is not wrong? Where go all of this power?<br />
Power consumption seem a lot of independent from cpu load... this seem hard to be right!<br />
Anyway with 12*0.5A=6W an heatsink is indinspensable when using ARM cores!<br />
  ---and---<br />
  component	description	-- voltage	-- current 	-- power  <br />
  AD7928	adc	-- 3.3	-- 0.0027	-- 0.00891<br />
WM8731	audio codec	-- 3.3	-- 0.0002	-- 0.00066<br />
Si5350C-B	clock	-- 3.3	-- 0.085	-- 0.2805<br />
<a href="../../../../../../www.icsi.com.tw/pdf/43TR16256A-85120AL.pdf">43TR16256A-85120AL	ddr3 sdram</a> -- 1.5	--	current is quite variable 0.08-0.800 -- power 0.1-1.0<br />
EPCS128	flash	-- 3.3	-- 0.0003	-- 0.00099<br />
ksz9021rl	ethernet	-- 3.3	-- 0.045	-- 0.1485<br />
ADXL345	accelerometer	-- 3.3	-- 0.00014	-- 0.000462<br />
IS42R16320D	fpga sdram	-- 3.3	-- 0.05	-- 0.165<br />
FT232R	uart to usb	-- 3.3	-- 0.015	-- 0.0495<br />
USB2512B		-- 3.3	-- 0.05	-- 0.165<br />
USB3300		-- 3.3	-- 0.025	-- 0.0825<br />
ADV7123	video dac	-- 3.3	-- 0.08	-- 0.264<br />
ADV7180	video decoder			-- 1.5 -- 0.044 -- 0.06<br />
USB Blaster		-- 3.3	-- 0.1	-- 0.33<br />
-----------------------------------------------------<br />
  <strong>Total				nonFPGA power = </strong>1.7 watt, but the uncertainty is large at least .5 watt</li>
</ul>
<hr />
<h3>&nbsp;</h3>
<hr />
<p>References:</p>
<p><a href="../index.html">DE1-SOC</a> literature list</p>
<p><a href="../../../../../../wwwhome.cs.utwente.nl/~molenkam/ods/low_power_exercise/dds-power.pdf" target="_blank" rel="noopener noreferrer" id="LPlnk528523" previewinformation="1">http://wwwhome.cs.utwente.nl/~molenkam/ods/low_power_exercise/dds-power.pdf</a><br />
  <a href="../../../../../../https@www.youtube.com/watch@v=F7t4WsuieIE" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=F7t4WsuieIE</a><br />
  <a href="../../../../../../www.eecg.toronto.edu/~vaughn/papers/power_optimization_2005.pdf" target="_blank" rel="noopener noreferrer">http://www.eecg.toronto.edu/~vaughn/papers/power_optimization_2005.pdf</a><br />
  <a href="../../../../../../citeseerx.ist.psu.edu/viewdoc/download@doi=10.1.1.698.4334&rep=rep1&type=pdf" target="_blank" rel="noopener noreferrer">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.698.4334&amp;rep=rep1&amp;type=pdf</a></p>
<hr />
<p>Copyright Cornell University 
  <!-- #BeginDate format:Am1 -->March 14, 2018<!-- #EndDate -->
</p>
<p>&nbsp;</p>
</body>
</html>
