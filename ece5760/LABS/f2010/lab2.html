
<html>
<head>
<title>ece5760 Lab 2</title>
</head>

<body>
<h2>
ECE 5760: Laboratory 2 </h2> 
<h2> Radio transmitter and receiver</h2>
<p>
<b> Introduction. </b>

<p> In this assignment you will implement  an AM transmitter and receiver. To
  test the transmitter, you will show that you can send voice or music to an
  external receiver from the transmitter. The digital RF signal will then be
  sent to a AM receiver on the FPGA, which will decode the audio and send it
back out throught the audio codec.<p> <b> Procedures:</b>  
<ol>
  <li>  You must handle the boards only on on the ESD mat. These boards are expensive and you must be careful of them. <p></p>
  <li>Make sure the Altera DE2 board is connected to power and to the PC as specified 
    in the evaluation board description. Turn on the power supply with the red switch 
    on the board. Make sure the toggle switch on the left edge of the board marked (<code>Run/Prog</code>) is in the <code>Run</code> position and <em>leave it there at all times</em>.
The FPGA will program in the <code>Run</code> position. Putting the switch in the <code>Prog</code> position writes your design to flash memory, which you do not want to do.<p></p>
  <li>The <a href="../../DE2/DE2_TOP.v">default top level module</a> for the DE2 defines all of the logical i/o signals. <p></p>
  <li>You can define the mapping from logical signal to FPGA pins (<em>pin assignment</em> in QuartusII) for all the pins at once by importing <a href="../../DE2/DE2_pin_assignments.csv">this file</a> using the menu item <code>Assignments... Import Assignments...</code> and specifying the file name. There is no need to define pins one-by-one.   <p></p>
<li>The hardware audio interface is a <a href="../../../../../../instruct1.cit.cornell.edu/courses/ece576/DE2_Datasheets/Audio CODEC/WM8731_WM8731L.pdf">Wolfson
WM8731</a> codec which is controlled by an I2C interface. I have simplified the
drivers somewhat. The cleanest version is in this <a href="../../../../../../instruct1.cit.cornell.edu/courses/ece576/DE2/AudioFilter_oct2009/AudioFilter_oct2009.zip">project
zip</a>. The context for the drivers is explained in the <a href="../../../../../../instruct1.cit.cornell.edu/courses/ece576/DE2/fpgaDSP.html">DSP
page</a>, example 1. <p></p>
<li><img src="VGAsocket.png" alt="vga socket" width="170" height="120" align="left">The <a href="../../DE2_Datasheets/VGA%20DAC/ADV7123_a.pdf">VGA output</a> can
  operate as a 50 MHz D/A converter if you set the <code>vga_blanking</code> and <code>vga_sync</code> i/o
  signals high. You also need to supply a clock to <code>VGA_CLK</code>. Output
  the sine wave through the VGA red channel.  The
  connector pinout is shown with the view of the socket looking at the edge of
  the board. If you accidentally ground one of the RGB outputs, it will <font color="#FF0000"><strong>instantly
  destroy</strong></font> the output driver on the DE2. A safe approach is to
  use one of the screws at the corner of the DE2 as ground for the scope. <br clear="left"><p></p>
<li>When modulating the RF signal, you will need to multiply the 16-bit 2's comp
  input from the audio codec by a 16-bit 2's comp sine wave carrier. A Verilog
  ROM module to generate a 16-bit sine wave is near the end of <a href="../../../../../../instruct1.cit.cornell.edu/courses/ece576/DDA/AnalogSimNiosII/FilterSimCPUintegrator.v">this
  code</a>, generated by a <a href="SinROM16bit.m">matlab program</a>. The table is designed to generate a sine wave with only 14 bits of amplitude, so that two sine waves can be added without further scaling to prevent overflow. For output through the VGA DAC, you will need to convert the 16-bit
  2's comp to 10-bit offset binary.
  <p></p>
<li>Download the <a href="AM_XR_direct_conversion.m">matlab example</a> to see the mathematical structure of the transmitter
  and receiver.<p></p>
<li>There are two more examples of CIC filters with <a href="../../../../../../www.altera.com/literature/an/an455.pdf">compensators</a>.
  The basic frequency response of the CIC filter is <br>
  <code>A(f)=mag(sin(&pi;Mf)/sin(&pi;f/R))<sup>N
  </sup></code><br>
  where M is the differential delay after decimation (usually one or two sample
  delay at the decimated rate), R is the decimation ratio, and N is number of
  concatenated stages. The CIC filter is followed by a low order IIR filter running
  at the decimated rate to compensate the low frequency response of the CIC and
  help with antialiasing the high frequency response.The <a href="CICfilters_modulation/CIC_response_N4_R10_M1_compensator.m">first
  example</a> shown
  below has N=4, R=10 and M=1. The input is noise plus a sine wave. With the
  compensation, the bandwidth is about 40% of the decimated bandwidth.<br>
  <img src="CICfilters_modulation/N4M1R10.png" width="929" height="289" alt="N4R10M1">  <br>
  The <a href="CICfilters_modulation/CIC_response_N2_R10_M2_compensator.m">second
  example</a> has N=2, R=10, and M=2. Cutoff is not quite as sharp because
  of the lower order (N). Bandwidth is also about 40% of the decimated bandwidth.<br>
  <img src="CICfilters_modulation/N2M2R10.png" width="929" height="289" alt="n2m2r10"><br>
  See also <a href="../../../../../../www.mikrocontroller.net/attachment/51932/cic2.pdf">CIC
    Filter Introduction by Matthew P. Donadio</a> and<a href="../../../../../../www.design-reuse.com/articles/10028/understanding-cascaded-integrator-comb-filters.html">Understanding
  CIC filters</a>.
</ol>
<p><strong>--Using   QuartusII SignalTap tool to verify your design.</strong> </p>
<p>Here are the steps that seem to be necssary to get SignalTap working. For more information, read the Altera <a href="../../Verilog/tut_signaltapII_verilogDE2.pdf">tutorial</a> on using SignalTap, an on chip logic analyzer. </p>
<ol>
  <li>Choose menu <code>Tools&gt;SignalTap</code></li>
  <li>In the main SignalTap window, click <code>Hardware Setup...</code> (in the upper rigtht corner) <br>
    and in the dialog box choose the hardware (USB-Blaster)</li>
  <li>Choose menu <code>Edit&gt;AddNodes... </code>
      <ol>
        <li>Choose the appropriate <code>Filter</code> to simplify the list of nodes, the press <code>List</code></li>
        <li>Highlight nodes and move to right-hand list using <strong><code>&gt;</code></strong> button </li>
        <li>Click <code>OK</code> to get back to main SignalTap window </li>
      </ol>
  </li>
  <li>In the main SignalTap window, click the <code>Clock ...</code> button and choose the clock signal as in AddNodes</li>
  <li>In the node panel of the main window, set up trigger conditions.</li>
  <li>Compile and then load the design onto the FPGA</li>
  <li> In the main SignalTap window, toggle the <code>Data/Setup</code> button</li>
  <li> Choose menu <code>Processing &gt;Run Analysis</code> </li>
</ol>
<hr>
<b> Assignment </b> 
<ul>
  <li> Build three AM transmitters on the FPGA with a carrier frequencies at
    800, 1000 and 1200 KHz. The DDS unit for the carrier should run at 50 MHz
    or lower. Modulate each carrier with
    a unique waveform, perhaps 3 different audio sine wave frequencies. You probably
    want to keep the modulation frequency below 5 khz or so. The DDS for the
    audio can run at the same rate. The output from all transmitters should be
    added together as 16-bit 2'comp numbers, and then converted to 10-bit offset
    binary and sent to a VGA DAC channel. Demonstrate to the TA that you can
    receive each transmitter on a standard AM radio by tuning the radio.</li>
  <li>Use the audio codec input to replace one of the three transmitter modulation
    inputs so that you can transmit waveforms from the signal generator or other
  audio source.
  <li>Loop
    back the summed transmitter signals into an AM receiver built on the FPGA
    so that you can receive each station by tuning the local oscillator. You
    will be building a <a href="../../../../../../en.wikipedia.org/wiki/Direct-conversion_receiver">direct
    conversion</a> AM reciever. The steps involved in building
    a receiver are explained in a <a href="AM_XR_direct_conversion.m">matlab
    program</a> and are
    summaried here:
    <ol>
    <li>Convert the looped-back, 10-bit transmitted signal back to 16-bit 2'comp.</li>
    <li>Mix with a local oscillator running at the carrier
      frequency to make a baseband signal.</li>
    <li>Lowpass the resulting baseband signal using a CIC filter to remove the
      sum term of the mixed signal and
      the out-of-tune stations. Decimate and lowpass to convert to audio rate
      by a 50MHz/48 KHz ratio or 1042.</li>
    <li>Include a Chebyshev compensator after the CIC filter. This will improve
      spectral flatness and minimize aliasing.</li>
    <li>Highpass filter to remove the DC component from the audio.</li>
  </ol>
  <li>Use the audio codec output to display  the received audio signal on the
    scope.<br>
  </li>
</ul>
<p>Be prepared to separately demo your transmitter and receiver design to your
  TA in lab. </p>
<p> Your written lab report should include the sections mentioned in the <a href="../../policy.html">policy page</a>, and :
<ul>
  <li>Filter frequencies and plots of filter response.  
  <li> A heavily commented listing of your Verilog design and GCC code. 
  <li>How close together can you make the transmitted carriers and still separate
  the modulation?
</ul>
<hr>
<small> <font size="-1">Copyright Cornell University </font></small>
<!-- #BeginDate format:Am1 -->September 10, 2010<!-- #EndDate -->
</body> </html>

