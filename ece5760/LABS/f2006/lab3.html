
<html>
<head>
<title>ee576 Lab 3</title>
</head>

<body>
<h2>
EE 576: Laboratory 3 </h2> 
<h2> NiosII graphics interface. </h2>
<p>
<b> Introduction. </b>

<p> In this assignment you will implement a video interface to the NiosII processor, including lines and text, then use it to animate a ball dropping. You will use the <a href="../../../../../../altera.com/education/univ/materials/manual/labs/tut_sopc_introduction_verilog.pdf">SOPC builder</a> to construct a NiosII processor, QuartusII to add a VGA video interface, and the NiosII IDE to write a GCC program to animate the ball. 
<p> <b> Procedures:</b>  
<ol>
  <li>  You must handle the boards only on on the ESD mat. These boards are expensive and you must be careful of them. 
  <li>Make sure the Altera DE2 board is connected to power and to the PC as specified 
    in the evaluation board description. Turn on the power supply with the red switch 
    on the board. Make sure the toggle switch on the left edge of the board marked (<code>Run/Prog</code>) is in the <code>Run</code> position and <em>leave it there at all times</em>.
The FPGA will program in the <code>Run</code> position. Putting the switch in the <code>Prog</code> position writes your design to flash memory, which you do not want to do.
  <li>The <a href="../../DE2/DE2_TOP.v">default top level module</a> for the DE2 defines all of the logical i/o signals. 
  <li>You can define the mapping from logical signal to FPGA pins (<em>pin assignment</em> in QuartusII) for all the pins at once by importing <a href="../../DE2/DE2_pin_assignments.csv">this file</a> using the menu item <code>Assignments... Import Assignments...</code> and specifying the file name. There is no need to define pins one-by-one.   
<li>A hardware VGA interface is shown on the <a href="../../../../../../instruct1.cit.cornell.edu/courses/ece576/DE2/index.html">DE2 page</a>. Read VGA example 1 Verilog code.
</ol>
<p>Setting up a project in the NiosII IDE:</p>
<ol>
  <li>Start the IDE and specify a workspace. When you designed the cpu and top-level module, the design was stored in a folder. In the Workspace selection dialog box, browse for that folder, then add the string <code>\software</code> to the folder path. This new folder will be used to store all of the software projects associated with the specific cpu you built in the SOPC. After you press OK, you may need to click on the <code>workbench</code> icon to do anything useful. </li>
  <li>Create a new software project. Select <code>File&gt;New&gt;project</code>. A series of dialog boxes will open. 
    <ol>
      <li>Choose <code>C/C++</code> application, then click <code>Next</code>. </li>
      <li>Give the project a <code>name</code>, specify the <code>ptf</code> file from SOPC builder, use the <code>default location</code>, and specify a <code>blank project</code>. <br>
      Then click <code>Next</code>.</li>
      <li>Select <code>creat new system library</code>  then click <code>finish</code>. </li>
    </ol>
  </li>
  <li>Back in the main IDE window, right-click on the <code>syslib</code> entry in the <code>C/C++ Projects </code>pane, then select <code>Properties</code>. 
    <ol>
      <li>In the dialog box, select <code>system library</code> on the left. </li>
      <li>Associate the desired device with <code>stdout</code>, <code>stdin</code>, and <code>stderr</code>. These will usually default to the JTAG UART. </li>
      <li>From the pulldown menu, select whether you are going to use <code>single threaded</code> or <code>microC/OS</code>. Note that the web-version of the IDE does not support the operating system. </li>
      <li>Select the memory location, usually defaults to SDRAM. </li>
      <li>Click <code>OK</code> to proceed. </li>
    </ol>
  </li>
  <li>Back in the main IDE window, right-click on the <code>syslib</code> entry in the <code>C/C++ Projects </code>pane, then select <code>Build Project</code>. <br>
  Wait for it to finish. </li>
  <li>Create header files using <code>File&gt;New&gt;headerfile </code>and C files using<code> File&gt;New&gt;file. </code></li>
</ol>
<hr>
<b> Assignment </b> 
<ul>
  <li> You will design the cpu system, plus timers, UARTs and parallel interfaces in SOPC, then use Verilog to add the VGA hardware interface. Don't use schematic entry or VHDL. </li>
  <li>The VGA graphics interface should include the ability to draw arbitrary lines and text. It is acceptable to run the VGA at 320x240 resolution. You will need to implement a character generator either in hardware or software (on the NiosII). You will also need to implement a <a href="../../../../../../graphics.idav.ucdavis.edu/education/GraphicsNotes/Bresenhams-Algorithm.pdf">breshenham</a> line drawing scheme in hardware or software. Full credit will only be given if at least one of the two (character generator, line generator) is in hardware. 
  <li>I suggest using SDRAM as memory for the NiosII and SRAM as the VGA display memory. Be sure to follow the suggestions in the <a href="../../DE2/tut_DE2_sdram_verilog.pdf">SDRAM tutorial</a> to get the SDRAM timing correct. </li>
  <li>When KEY3 is pressed to indicate reset, the region in which a ball will bounce should be drawn. The region will include the upper left and lower left corner of the screen, plus two points chosen randomly, one on the top half of the right screen boundary, and one on the bottom screen boundary. </li>
  <li>Once you can draw boundary lines, animate a ball released from the upper-left corner of the screen with some horizontal velocity, falling under the influence of gravity, and with energy loss at each bounce. Pressing KEY3 should reset the ball to the upper left corner. The ball should bounce off the inside of a box drawn as straight lines. The elapsed time in sceonds should be shown in the lower right corner. </li>
  <li>You will need to come up with a command scheme so that the cpu can communicate with the VGA graphics interface. Minimally, there needs to be commands to:
    <ul>
      <li>erase the screen</li>
      <li>draw a point at x,y in any color </li>
      <li>draw a line from x1,y1 to x2,y2  in any color (if the line generator is in hardware) </li>
      <li>draw a character  at x,y in any color (if the character generator is in hardware)
        
      </li>
    </ul>
	There
also needs to feedback to the cpu from the graphics system to:
	<ul>
	  <li>read a point at x,y</li>
      <li>signal the cpu that the graphics system is ready for another command </li>
	</ul>
  </li>
  <br>
  Be prepared to demo your design to your TA in lab.
  </li>
</ul>
<p> Your written lab report should include: 
<ul>
  <li>How you made the character and line generators. 
  <li>A detailed dsecritpion of your SOPC design. 
  <li> A heavily commented listing of your Verilog design and GCC code. 
</ul>
<hr>
<small> <font size="-1">Copyright Cornell University July 2006</font></small> 
</body> </html>

